<div class="zona-container">
  <div class="background-decoration">
    <div class="cloud cloud-1"></div>
    <div class="cloud cloud-2"></div>
    <div class="star star-1">‚≠ê</div>
    <div class="star star-2">‚≠ê</div>
  </div>

  <header class="section-header">
    <div class="header-left">
      <span class="star-icon"><img src="assets/images/logoCarolinaPsicologa.png" alt="Logo Carolina Psic√≥loga" class="logo-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"></span>
      <a routerLink="/zona-profesional" class="back-link">‚Üê Volver</a>
    </div>
    <div class="header-center">
      <h1 class="section-title">Atenciones Grupales</h1>
    </div>
    <div class="header-right">
      <div class="dropdown">
        <select class="dropdown-select" (change)="onSelectChange($event)">
          <option value="">Usuario</option>
          <option value="logout">Cerrar Sesi√≥n</option>
        </select>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="welcome-section">
      <h2 class="welcome-title">
        Atenciones Grupales ‚Äì Psicolog√≠a Escolar
        <span class="title-star">‚≠ê</span>
      </h2>
      <p class="welcome-subtitle">Las atenciones grupales fortalecen el bienestar emocional y la convivencia escolar.</p>
      <div class="month-selector">
        <label for="mes">Mes:</label>
        <select id="mes" [(ngModel)]="selectedMonth" (change)="onMonthChange()">
          <option *ngFor="let mes of meses" [value]="mes.value">{{ mes.label }}</option>
        </select>
        <button class="add-button" (click)="toggleForm()">+ Agregar Atenci√≥n</button>
      </div>
    </div>

    <div class="form-section" *ngIf="showForm">
      <div class="form-container">
        <h3>Registrar Nueva Atenci√≥n Grupal</h3>
        <form class="atencion-form" (ngSubmit)="guardarAtencion()">
          <div class="form-row">
            <div class="form-group">
              <label for="grado">Grado:</label>
              <select id="grado" [(ngModel)]="nuevaAtencion.grado" name="grado" required>
                <option *ngFor="let grado of grados" [value]="grado">{{ grado }}</option>
              </select>
            </div>
            <div class="form-group">
              <label for="fecha">Fecha:</label>
              <input type="date" id="fecha" [(ngModel)]="nuevaAtencion.fecha" name="fecha" required>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="tema">Tema:</label>
              <input type="text" id="tema" [(ngModel)]="nuevaAtencion.tema" name="tema" placeholder="Tema de la sesi√≥n" required>
            </div>
            <div class="form-group">
              <label for="numeroParticipantes">N√∫mero de Participantes:</label>
              <input type="number" id="numeroParticipantes" [(ngModel)]="nuevaAtencion.numeroParticipantes" name="numeroParticipantes" min="1" required>
            </div>
          </div>
          <div class="form-group">
            <label for="objetivos">Objetivos:</label>
            <textarea id="objetivos" [(ngModel)]="nuevaAtencion.objetivos" name="objetivos" placeholder="Objetivos de la sesi√≥n"></textarea>
          </div>
          <div class="form-group">
            <label for="actividades">Actividades:</label>
            <textarea id="actividades" [(ngModel)]="nuevaAtencion.actividades" name="actividades" placeholder="Actividades realizadas"></textarea>
          </div>
          <div class="form-group">
            <label for="observaciones">Observaciones:</label>
            <textarea id="observaciones" [(ngModel)]="nuevaAtencion.observaciones" name="observaciones" placeholder="Observaciones adicionales"></textarea>
          </div>
          <div class="form-actions">
            <button type="submit" class="save-button">Guardar</button>
            <button type="button" class="cancel-button" (click)="toggleForm()">Cancelar</button>
          </div>
        </form>
      </div>
    </div>

    <div class="summary-section" *ngIf="!loading">
      <div class="summary-cards" *ngIf="atencionesPorGrado.length > 0; else noData">
        <div class="summary-card" *ngFor="let grado of atencionesPorGrado">
          <h3>{{ grado.grado }}</h3>
          <p>Se realizaron {{ grado.total }} atenciones grupales</p>
          <p>üìÖ D√≠as: {{ grado.dias.join(', ') }}</p>
        </div>
      </div>
      <ng-template #noData>
        <div class="no-data-message">
          <p>No hay atenciones grupales registradas para este mes.</p>
          <p>¬°Agrega la primera sesi√≥n grupal!</p>
        </div>
      </ng-template>
    </div>

    <div class="loading-section" *ngIf="loading">
      <p>Cargando atenciones...</p>
    </div>

    <div class="chart-section" *ngIf="!loading && atencionesPorGrado.length > 0">
      <h3>Gr√°fica de Atenciones Grupales</h3>
      <div class="chart-container">
        <div class="bar-chart">
          <div class="bar" *ngFor="let grado of atencionesPorGrado; let i = index">
            <div class="bar-label">{{ grado.grado }}</div>
            <div class="bar-visual" [style.width.%]="maxAtenciones > 0 ? (grado.total / maxAtenciones) * 100 : 0">
              <span class="bar-value">{{ grado.total }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="details-section" *ngIf="!loading && atencionesPorGrado.length > 0">
      <h3>Detalle por Grado</h3>
      <div class="grade-details">
        <div class="grade-card" *ngFor="let grado of atencionesPorGrado">
          <div class="grade-header" (click)="toggleDetails(grado)">
            <h4>{{ grado.grado }}</h4>
            <span class="toggle-icon">{{ grado.expanded ? '‚ñº' : '‚ñ∂' }}</span>
          </div>
          <div class="grade-content" *ngIf="grado.expanded">
            <div class="session-item" *ngFor="let dia of grado.dias; let i = index">
              <p>üìÖ {{ dia }} de {{ selectedMonthLabel }} ‚Äì {{ getAtencionDetails(grado.grado, dia) }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
